# Nixpacks configuration for Railway
[phases.setup]
nixPkgs = ["git", "curl", "gcc", "zlib", "libjpeg", "libpng", "freetype"]
aptPkgs = ["git", "curl", "build-essential", "libffi-dev", "libjpeg-dev", "zlib1g-dev", "libpng-dev", "libfreetype6-dev"]

[phases.install]
cmds = ["pip install --upgrade pip", "pip install -r requirements.txt"]

[start]
cmd = "python3 -c \"from models.database import engine, Base; Base.metadata.create_all(bind=engine); print('Database initialized')\" && python3 migrate_db.py || echo 'Migration skipped' && gunicorn main:app -w 2 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT --timeout 120"
